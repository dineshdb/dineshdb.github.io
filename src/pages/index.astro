---
import BaseLayout from "../layouts/BaseLayout.astro";
import { Image } from "astro:assets";
import homeIllustration from "../assets/home-illustration.webp";
import { SITE_DESCRIPTION, SITE_TITLE } from "../consts";
import NowCard from "../components/NowCard.astro";
import BlogCard from "../components/BlogCard.astro";
import SectionHeader from "../components/SectionHeader.astro";
import { renderUpdates } from "../utils/renderUpdates";
import { getRecentBlogPosts, getRecentUpdates, withBlogUrls } from "../utils/content";

const [recentPosts, recentNow] = await Promise.all([
  getRecentBlogPosts(3).then(withBlogUrls),
  getRecentUpdates(2)
]);

// Render now update contents
const renderedNow = await renderUpdates(recentNow);
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
  <div class="px-0 py-16 sm:py-24" slot="hero">
    <div class="max-w-4xl mx-auto flex flex-col md:flex-row items-center justify-center gap-8 md:gap-12">
      <div class="flex-1 text-center md:text-left">
        <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold text-stone-900 dark:text-stone-100 leading-tight">
          {SITE_DESCRIPTION}
        </h1>
      </div>

      <div class="shrink-0">
        <div class="rounded-2xl shadow-lg">
          <Image
            class="w-auto h-auto"
            alt="Illustration of person reading a book"
            src={homeIllustration}
            width={500}
            format="webp"
          />
        </div>
      </div>
    </div>
  </div>

  {recentPosts.length > 0 && (
    <div class="pt-16">
      <SectionHeader title="Recent Posts" linkUrl="/blog" />
      <div class="flex flex-col gap-6">
        {recentPosts.map((post) => (
          <BlogCard post={post} />
        ))}
      </div>
    </div>
  )}

  {renderedNow.length > 0 && (
    <div class="pt-16">
      <SectionHeader title="Recent Updates" linkUrl="/now" />
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {renderedNow.map(({ update, content: Content }) => (
          <NowCard update={update} content={Content} />
        ))}
      </div>
    </div>
  )}
</BaseLayout>
