---
import { getCollection } from "astro:content";
import calculateReadingTime from "reading-time";
import Bio from "../../components/Bio.astro";
import DateTime from "../../components/DateTime.astro";
import Tag from "../../components/Tag.astro";
import WebMentions from "../../components/WebMentions.svelte";
import BaseLayout from "../../layouts/BaseLayout.astro";

export async function getStaticPaths() {
  const blogEntries = await getCollection("blog");
  return blogEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry, readingTime: calculateReadingTime(entry.body) },
  }));
}
const { entry, readingTime } = Astro.props;
const { Content, remarkPluginFrontmatter } = await entry.render();
---

<BaseLayout
  title={entry.data.title}
  description={entry.data.description}
  permalink={`/blog/${entry.data.slug}`}
  image={entry.data.image}
  current="blog"
>
  <article class="max-w-2xl mx-auto">
    <header class="mb-8">
      <h1 class="text-3xl sm:text-4xl font-bold text-stone-900 dark:text-stone-100 leading-tight mb-4">
        {entry.data.title}
      </h1>
      {entry.data.description && (
        <p class="text-xl text-stone-600 dark:text-stone-400 mb-6">
          {entry.data.description}
        </p>
      )}
      <div class="flex flex-wrap items-center gap-3 text-sm text-stone-500 dark:text-stone-400">
        <span>
          <DateTime datetime={remarkPluginFrontmatter.publishDate} />
        </span>
        <span>Â·</span>
        <span>{readingTime.text}</span>
        {entry.data.tags.map((tag) => <Tag tag={tag} />)}
      </div>
      <hr class="mt-8 border-stone-200 dark:border-stone-800" />
    </header>

    <div class="prose max-w-none">
      <Content />
    </div>

    <WebMentions client:only="svelte" />

    <hr class="my-8 border-stone-200 dark:border-stone-800" />
    <Bio />
  </article>
</BaseLayout>
